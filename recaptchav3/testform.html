<!DOCTYPE html>
<html>
  <head>
    <title>MD5, SHA, and HMAC calculator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/base-min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">
    <link rel="stylesheet" type="text/css"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <script src='https://www.google.com/recaptcha/api.js?render=6LeEA3gUAAAAAPRenCnqy8K4IuLepRPAPLNIKOY_'></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"</script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-md5.js"></script>
    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha1.js"></script>
    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha224.js"></script>
    <script type='text/javascript'

            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha256.js"></script>
    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha384.js"></script>

    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/hmac-sha512.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/md5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha224.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha256.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha384.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/sha512.js"></script>

    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/core-min.js"></script>
    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/enc-utf16-min.js"></script>
    <script type='text/javascript'
            src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/components/enc-base64-min.js"></script>

    <style type='text/css'>
     body {
       font-size: 180%;
     }
     body > div {
       display: flex;
       height: auto;
       max-width: 1440px;
       margin: 0 auto;
     }
     form div label {
       float: left;
       width: 148px;
       margin: 8px 0;
     }
     form > div > select,
     form > div > textarea,
     form > div > input {
       float: left;
       max-width: 860px;
       margin: 2px 0;
     }
     form > div,
     form > div.form-group {
       display:block;
       clear:both;
     }
     #output, #notes {
       display:block;
       border-color: White;
       border-style: solid;
       border-width: 1px;
       margin-top: 54px;
     }
     #notes {
       border-top:  thick double #32a1ce;
     }
     #notes {
       font-size:80%;
       color: #565656;
     }
     #output > div {
       margin-top: 16px;
     }
     #output > div > span {
       display:block;
       width: 228px;
     }
     #output > div > div:last-of-type {
       border: 1px dotted Grey;
       max-width: 1248px;
       width: 1248px;
       margin: 2px 0;
       padding: 4px 10px;
       font-size: 75%;
       float: left;
     }
     .code {
       font-family: "Consolas", "Courier New", Courier, monospace;
     }
     #key.notshown,
     #keylabel.notshown,
     #output.notshown > div > div {
       display: none;
     }
     #key.shown,
     #keylabel.shown,
     #output.shown > div > div {
       display: block;
     }
     #output > div > .copyIconHolder {
       /* https://material.io/icons/#ic_content_copy */
       content: url('images/ic_content_copy_black_24dp_1x.png');
       padding-right: 5px;
       float: left;
       margin-top: 4px;
     }
     #output > div:after {
       content: "";
       display: table;
       clear: both;
     }
     .disabled {
       color:  #F1F1f1;
       background: none repeat scroll 0 0 #DCDCDC;
       cursor: default !important;
     }
     input[type="radio"] {
       vertical-align: middle;
       margin-top: 8px;
     }
     input[type="radio"] + div {
       display:block;
       margin-left:166px;
     }
     input[type="checkbox"] {
       vertical-align: middle;
       margin-top: 14px;
     }
     form > div > select {max-width:120px;}
    </style>

    <script type='text/javascript'>
     var reCAPTCHA_site_key = '6LeEA3gUAAAAAPRenCnqy8K4IuLepRPAPLNIKOY_';
     var postbackEndpoint = 'https://gaccelerate3-test.apigee.net/recaptcha/compute';
     
     function getHashName() {
       var hashName = $('#function option:selected').val();
       return hashName;
     }

     function getAlgo() {
       switch (getHashName()) {
         case 'md-5':
           return CryptoJS.algo.MD5;
           break;
         case 'sha-1':
           return CryptoJS.algo.SHA1;
           break;
         case 'sha-224':
           return CryptoJS.algo.SHA224;
           break;
         case 'sha-256':
           return CryptoJS.algo.SHA256;
           break;
         case 'sha-384':
           return CryptoJS.algo.SHA384;
           break;
         case 'sha-512':
           return CryptoJS.algo.SHA512;
           break;
       }
       throw { error: 'unsupported hash name.'};
     }

     function getHash(message) {
       switch (getHashName()) {
         case 'md-5':
           return CryptoJS.MD5(message);
           break;
         case 'sha-1':
           return CryptoJS.SHA1(message);
           break;
         case 'sha-224':
           return CryptoJS.SHA224(message);
           break;
         case 'sha-256':
           return CryptoJS.SHA256(message);
           break;
         case 'sha-384':
           return CryptoJS.SHA384(message);
           break;
         case 'sha-512':
           return CryptoJS.SHA512(message);
           break;
       }
       throw { error: 'unsupported hash name.'};
     }

     function eraseResults() {
       $('#resultB16').text('');
       $('#resultB64').text('');
       $('#output').addClass('notshown').removeClass('shown');
     }

     function publishResults(arg1, arg2) {
       if (arg2) {
         $('#resultB16').text(arg2);
         $('#resultB64').text('error');
       }
       else if (arg1) {
         var hashInBase16 = CryptoJS.enc.Hex.stringify(arg1);
         $('#resultB16').text(hashInBase16);
         var hashInBase64 = CryptoJS.enc.Base64.stringify(arg1);
         $('#resultB64').text(hashInBase64);
       }
       $('#output').addClass('shown').removeClass('notshown');
     }

     function calcHmac() {
       var message = $('#text').val();
       var key = $('#key').val();
       if (message!=null && key) {
         var re1 = new RegExp('(\r\n|\n)', 'g');
         message = message.replace(re1,'\n');
         var hmac = CryptoJS.algo.HMAC.create(getAlgo(), key);
         hmac.update(message);
         var hash = hmac.finalize();
         publishResults(hash);
       }
       else {
         publishResults(null, 'You must specify a message and a key');
       }
     }

     function calcSha() {
       var message = $('#text').val();
       if (message!=null) {
         var re1 = new RegExp('(\r\n|\n)', 'g');
         message = message.replace(re1,'\n');
         var hash = getHash(message);
         publishResults(hash);
       }
     }

     function calcResult(event) {
       if (event) { event.preventDefault(); }
       var message = $('#text').val();
       //var re1 = new RegExp('(\r\n|\n)', 'g');
       //alert('message:\n' + message.replace(re1,'\\n\n'));
       if (message) {
         if ($('#hmac').is(':checked')) {
           calcHmac();
         }
         else {
           calcSha();
         }
       }
     }

     function changeText(event) {
       if (getHashName()) {
         calcResult(event);
       }
     }
     function changeKey(event) {
       if (getHashName()) {
         calcResult(event);
       }
     }

     function changeFunction(event) {
       if (event) { event.preventDefault(); }
       // enable the compute button
       // $( "#submit" ).removeClass('disabled').prop("disabled", false);
       //eraseResults();
       calcResult(event);
     }

     function changeHmac(event) {
       if (event) { event.preventDefault(); }
       // display or hide the key as appropriate
       if ($('#hmac').is(':checked')) {
         $('#key').addClass('shown') .removeClass('notshown');
         $('#keylabel').addClass('shown') .removeClass('notshown');
         $( "#key" ).removeClass('disabled') .prop("disabled", false);
       }
       else {
         $('#key').addClass('notshown') .removeClass('shown');
         $('#keylabel').addClass('notshown') .removeClass('shown');
         $( "#key" ).addClass('disabled') .prop("disabled", true);
       }
       //eraseResults();
       calcResult(event);
     }

     function selectText(element) {
       var doc = document, range, selection;
       if (doc.body.createTextRange) {
         range = document.body.createTextRange();
         range.moveToElementText(element);
         range.select();
       }
       else if (window.getSelection) {
         selection = window.getSelection();
         range = document.createRange();
         range.selectNodeContents(element);
         selection.removeAllRanges();
         selection.addRange(range);
       }
     }

     function copyToClipboard() {
       var $iconDiv = $(this);
       var $textHolder = $iconDiv.next();
       selectText($textHolder[0]);
       try {
         document.execCommand('copy');
       }
       catch(exc1) {
       }
     }

     function applyRecaptchaPreSubmit(event) {
       // prevent form submit
       if (event) { event.preventDefault(); } 
       // get new token for this click
       grecaptcha
               .execute(reCAPTCHA_site_key, {action: 'homepage'})
               .then(function(recaptchaToken) {

         //alert("recaptcha token:\n "+ recaptchaToken);

         // post back to an endpoint . The thing on the other end will call to
         // google to ask for the score for this user/token. 
         var jqxhr = $.ajax({
           url: postbackEndpoint,
           method: "POST",
           data: { recaptcha_token: recaptchaToken },
           dataType : 'json'
         })
         .done(function(responseData) {
           alert( "success: " + JSON.stringify(responseData));
         })
         .fail(function() {
           alert( "error" );
         })
         .always(function() {
           alert( "complete" );
         });
 
         //$('#form1').submit();
       });
       return false;
     }
     
     grecaptcha.ready(function() {
       $(document).ready(function() {
         $('#function').val('');
         $('#function').change(changeFunction);
         $('#function').val('sha-1');
         $('#hmac').change(changeHmac);
         $('#go').on('click', applyRecaptchaPreSubmit);
         $('#text').bind('input propertychange', changeText);
         $('#key').bind('input propertychange', changeKey);
         $('.copyIconHolder').on('click', copyToClipboard);
         changeHmac();
       });

     });

    </script>

  </head>

  <!-- ======================================================= -->

  <body>

    <div>
    <div style='margin: 10px;'>
      <h3>Calculate a SHA or MD5, or an HMAC with SHA or MD5</h3>

      <form role='form' id='form1' accept-charset='UTF-8'>
        <div class="form-group">
          <label for="function">hash function:</label>
          <select name="function" id="function" class="form-control">
            <option value="" selected></option>
            <option value="md-5" >md-5</option>
            <option value="sha-1" >sha-1</option>
            <option value="sha-224" >sha-224</option>
            <option value="sha-256" >sha-256</option>
            <option value="sha-384" >sha-384</option>
            <option value="sha-512" >sha-512</option>
          </select>
        </div>

        <div class='form-group'>
          <label for='hmac'>hmac?:</label>
          <input type="checkbox" name="hmac" id='hmac'/>
        </div>

        <div class='form-group'>
          <label for='key' id='keylabel'>secret key:</label>
          <input type='text' id='key' class='form-control disabled' disabled
                 placeholder="secret key"
                 title='The key or password for the HMAC. This data never leaves your browser.'/>
        </div>

        <div class='form-group'>
          <label for='text'>text or message:</label>
        <!-- input type='textarea' id='text' class='form-control'  -->
          <textarea class="form-control" rows="5" id='text'
                 placeholder="-insert your message here-"
                    title='The message to use in the function. This data never leaves your browser.'></textarea>
        </div>

        <div class='form-group'>
          <input type='submit' value='compute' class='button' id='go'/>
        </div>
      </form>

      <div id='output' class='notshown'>
        <div>
          <span>HEX-encoded result:</span>
          <div class='copyIconHolder' title='click to copy'></div>
          <div id='resultB16' class='code' title='hex encoding is case-insensitive'></div>
        </div>
        <div>
          <span>Base64-encoded result:</span>
          <div class='copyIconHolder' title='click to copy'></div>
          <div id='resultB64' class='code' title='base64 encoding is case-sensitive'></div>
        </div>
      </div>
      
    </div>
  </body>

</html>
