<!DOCTYPE html>
<html>
  <head>
    <title>Load generator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" 
          href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script type='text/javascript'
            src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script type='text/javascript' src='js/CountdownTimer.js'></script>
    <script type='text/javascript' src='js/s3u-jsonpath.js'></script>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.js'></script>
    <script type='text/javascript' src='js/load-generator-page.js'></script>
  </head>

  <body>
    <div id='main-div'>

      <h2>Request Generator
      <button class="btn btn-default btn-outline" id='open-help'>Help</button>
      </h2>
      
      <div id='help-message' title="Help">
        <p>This web page will generate a stream of requests against one or more HTTP Endpoints, with parameters that you specify.</p>
        <p>Usage</p>
        <ol>
          <li>It's required to select the verb, the URL, and optionally the headers to send. If the verb is PUT or POST, then you can also specify the request payload. </li>
          <li>Specify the "batch size" - this is the number of identical requests to make in sequence.</li>
          <li>Select the "speed factor". It goes to 11.</li>
          <li>If you want to send requests of different types, you can click the + tab to add a new request, with a new verb, url, headers, payload, and batchsize.</li>
          <li>If you added a request you don't want, click the X to remove the tab.</li>
          <li>Batches run in sequence. So if you have two requests, with batchsize 1 and 14 respectively, each run will send one of the first request, and 14 of the second.</li>
          
          <li>For each request, you can extract values from the response JSON payloads using jsonpath.
            Use the "Post-Response Extracts" tab to specify that.
            You can then employ those values in the url, payload, or headers for subsequent requests.</li>
          
        </ol>
        <p>Notes</p>
        <ol>
          
          <li>Endpoints specified here must support <a href='https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS'>CORS</a>
            and must <span title='Access-Control-Allow-Origin: *'>allow any origin.</span> If
            you don't have a CORS-enable endpoint, then all requests will
            fail. This is due to the same-origin policy enforced by the
            browser.</li>
          
          <li>The behavior of the extraction logic is not defined or
            tested for responses that contain non-JSON payloads.</li>
          
          <li>You can change the URLs, headers, payload, etc, while the
            agent is running. But be careful - the agent won't wait for
            you to get everything formatted correctly in your URL or JSON
            payload!</li>
          
          <li>The page uses LocalStorage to remember your most recent settings.</li>
          
          <li>No information is sent to any endpoint, other than the ones you specify.</li>
          
        </ol>
      </div>
      
      <form role="form">
        <div class="form-group">
          
          <div id='requestHolder'>
            <ul>
              <li id='request-li-0'><a href='#request-adder-tab'>+</a></li>
            </ul>
            <div id='request-adder-tab'></div>
          </div>

          <div class='speedfactor'>
            <label for'='speedfactor'>speed factor:</label>
            <select name="speedfactor" id="speedfactor" class="form-control" style='width:auto;position:relative;float:left;' required title='it goes to 11'></select>
          </div>
          <div style='width:100%;clear:both;'></div>
          <div class="form-group col-sm-1 nopadding" style='position:relative; width:auto; float:left; padding-left: 4px; padding-right: 4px;' >
            <button class="btn btn-success send-req" id='startstop'>Start</button>
          </div>
          <div class="form-group col-sm-1 nopadding" style='position:relative; width:auto;float:left; padding-left: 4px; padding-right: 4px;' >
            <button class="btn btn-default btn-outline send-req" id='reset'>Reset</button>
          </div>
          <div style='width:100%;clear:both;'></div>
        </div>
        
      </form>

      <div id='output'>
        <div>status: <span id='status'>--</span></div>
        <div>success: <span id='requestcount'>0</span></div>
        <div>errors: <span id='errorcount'>0</span></div>
      </div>
    </div>

  </body>

</html>
